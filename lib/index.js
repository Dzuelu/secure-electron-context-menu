"use strict";var _lodash=require("lodash");Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var defaultOptions={templateAttributeName:"cm-template",payloadAttributeName:"cm-payload",idAttributeName:"cm-id"},contextMenuRequest="ContextMenu-Request",contextMenuResponse="ContextMenu-Response",contextMenuClicked="ContextMenu-Clicked",ContextMenu=function(){function a(b){_classCallCheck(this,a),this.options=defaultOptions,this.selectedElement=null,this.selectedElementAttributes={},this.contextMenuParams={},this.stagedInternalFnMap={},this.internalFnMap={},this.cleanedTemplates={},"undefined"!=typeof b&&(this.options=Object.assign(this.options,b))}return _createClass(a,[{key:"preloadBindings",value:function preloadBindings(a){var b=this,c=function(){b.id="",a.on(contextMenuRequest,function(c,d){var e=null;if(b.selectedElement=null,b.selectedElementAttributes={},b.contextMenuParams=d.params,b.selectedElement=document.elementFromPoint(d.params.x,d.params.y),null!==b.selectedElement){var h=b.selectedElement.getAttribute(b.options.templateAttributeName);if(""!==h&&null!==h){for(var f=b.selectedElement.attributes,g=0;g<f.length;g++)0<=f[g].name.indexOf(b.options.payloadAttributeName)?b.selectedElementAttributes[f[g].name.replace("".concat(b.options.payloadAttributeName,"-"),"")]=f[g].value:0<=f[g].name.indexOf(b.options.idAttributeName)&&(b.id=f[g].value);e=h}}a.send(contextMenuResponse,{id:b.id,params:d.params,template:e})}),a.on(contextMenuClicked,function(a,c){var d=0<=c.id.indexOf("___");if(d){var f=c.id.split("___");if(f[0]!==b.id)return;"undefined"==typeof b.internalFnMap[c.id]&&(b.internalFnMap[c.id]=b.stagedInternalFnMap[f[1]])}else"undefined"==typeof b.internalFnMap[c.id]&&(b.internalFnMap[c.id]=b.stagedInternalFnMap[c.id]);var e={params:b.contextMenuParams,attributes:b.selectedElementAttributes};b.internalFnMap[c.id](e)})};return c(),{onReceive:function onReceive(a,c){b.stagedInternalFnMap[a]=c},clearRendererBindings:function clearRendererBindings(){b.stagedInternalFnMap={},b.internalFnMap={},b.contextMenuParams={},a.removeAllListeners(contextMenuRequest),a.removeAllListeners(contextMenuClicked),c()}}}},{key:"mainBindings",value:function mainBindings(a,b,c,d,e){var f=this;b.webContents.on("context-menu",function(a,c){b.webContents.send(contextMenuRequest,{params:c})}),a.on(contextMenuResponse,function(a,g){var h,j=g.id?"".concat(g.id,"___"):"",k="".concat(j).concat(g.template);if(null===g.template||"undefined"==typeof f.cleanedTemplates[k]){if(h=e[g.template]?(0,_lodash.cloneDeep)(e[g.template]):[],d&&h.push({label:"Inspect element",click:function click(){b.inspectElement(g.params.x,g.params.y)}}),null!==g.template)for(var l=function(a){"undefined"==typeof h[a].click&&(h[a].click=function(){b.webContents.send(contextMenuClicked,{id:"".concat(j).concat(h[a].id||h[a].label)})})},m=0;m<h.length;m++)l(m);f.cleanedTemplates[k]=h}h=f.cleanedTemplates[k],c.buildFromTemplate(h).popup(b)})}},{key:"clearMainBindings",value:function clearMainBindings(a){this.cleanedTemplates={},a.removeAllListeners(contextMenuResponse)}}]),a}(),contextMenu=new ContextMenu,_default=contextMenu;exports["default"]=_default;