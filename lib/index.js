"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var defaultOptions={templateAttributeName:"cm-template",payloadAttributeName:"cm-payload"},contextMenuRequest="ContextMenu-Request",contextMenuResponse="ContextMenu-Response",contextMenuClicked="ContextMenu-Clicked",ContextMenu=function(){function a(b){_classCallCheck(this,a),this.options=defaultOptions,this.selectedElement=null,this.selectedElementAttributes={},this.contextMenuParams={},this.internalFnMap={},this.templatesCleaned={},"undefined"!=typeof b&&(this.options=Object.assign(this.options,b))}return _createClass(a,[{key:"preloadBindings",value:function preloadBindings(a){var b=this,c=function(){a.on(contextMenuRequest,function(c,d){var e=null;if(b.selectedElement=null,b.selectedElementAttributes={},b.contextMenuParams=d.params,b.selectedElement=document.elementFromPoint(d.params.x,d.params.y),null!==b.selectedElement){var h=b.selectedElement.getAttribute(b.options.templateAttributeName);if(""!==h&&null!==h){for(var f=b.selectedElement.attributes,g=0;g<f.length;g++)0<=f[g].name.indexOf(b.options.payloadAttributeName)&&(b.selectedElementAttributes[f[g].name.replace("".concat(b.options.payloadAttributeName,"-"),"")]=f[g].value);e=h}}a.send(contextMenuResponse,{params:d.params,template:e})}),a.on(contextMenuClicked,function(a,c){if("undefined"!=typeof b.internalFnMap[c.id]){var d={params:b.contextMenuParams,attributes:b.selectedElementAttributes};b.internalFnMap[c.id](d)}})};return c(),{onReceive:function onReceive(a,c){b.internalFnMap[a]=c},clearRendererBindings:function clearRendererBindings(){b.internalFnMap={},b.contextMenuParams={},a.removeAllListeners(contextMenuRequest),a.removeAllListeners(contextMenuClicked),c()}}}},{key:"mainBindings",value:function mainBindings(a,b,c,d,e){var f=this;b.webContents.on("context-menu",function(a,c){b.webContents.send(contextMenuRequest,{params:c})}),a.on(contextMenuResponse,function(a,g){var h;if(null===g.template||"undefined"==typeof f.templatesCleaned[g.template]){if(h=e[g.template]||[],d&&h.push({label:"Inspect element",click:function click(){b.inspectElement(g.params.x,g.params.y)}}),null!==g.template)for(var j=function(a){"undefined"==typeof h[a].click&&(h[a].click=function(){b.webContents.send(contextMenuClicked,{id:h[a].id||h[a].label})})},k=0;k<h.length;k++)j(k);f.templatesCleaned[g.template]=!0}else h=e[g.template];c.buildFromTemplate(h).popup(b)})}},{key:"clearMainBindings",value:function clearMainBindings(a){this.templatesCleaned={},a.removeAllListeners(contextMenuResponse)}}]),a}(),contextMenu=new ContextMenu,_default=contextMenu;exports["default"]=_default;